global:
  resolve_timeout: 5m
  smtp_from: 'alertmanager@axiom.com'
  smtp_smarthost: 'mailhog:1025'
  smtp_require_tls: false

# Route configuration
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'
  
  routes:
    # Critical alerts - immediate notification
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 4h
    
    # Cost alerts - notify finance team
    - match:
        category: cost
      receiver: 'cost-alerts'
      group_wait: 5m
      repeat_interval: 24h
    
    # Data quality alerts
    - match:
        category: data_quality
      receiver: 'data-quality-alerts'
      repeat_interval: 6h
    
    # Pipeline failures
    - match:
        category: pipeline
      receiver: 'pipeline-alerts'
      repeat_interval: 2h
    
    # SLA violations
    - match:
        category: sla
      receiver: 'sla-alerts'
      group_wait: 0s
      repeat_interval: 1h

# Receivers configuration
receivers:
  - name: 'default'
    email_configs:
      - to: 'team@axiom.com'
        headers:
          Subject: '[Axiom] {{ .GroupLabels.alertname }}'
        html: |
          <h2>Alert: {{ .GroupLabels.alertname }}</h2>
          <p><strong>Summary:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>Description:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Severity:</strong> {{ .CommonLabels.severity }}</p>
          <p><strong>Started:</strong> {{ .StartsAt }}</p>
    
  - name: 'critical-alerts'
    email_configs:
      - to: 'oncall@axiom.com, team@axiom.com'
        headers:
          Subject: 'üö® [CRITICAL] {{ .GroupLabels.alertname }}'
        html: |
          <h1 style="color: red;">CRITICAL ALERT</h1>
          <h2>{{ .GroupLabels.alertname }}</h2>
          <p><strong>Summary:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>Description:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Started:</strong> {{ .StartsAt }}</p>
          <p style="color: red;"><strong>ACTION REQUIRED IMMEDIATELY</strong></p>
    # Add Slack/PagerDuty integration here
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK'
    #     channel: '#alerts-critical'
    
  - name: 'cost-alerts'
    email_configs:
      - to: 'finance@axiom.com, team@axiom.com'
        headers:
          Subject: 'üí∞ [Cost Alert] {{ .GroupLabels.alertname }}'
        html: |
          <h2>Cost Alert: {{ .GroupLabels.alertname }}</h2>
          <p><strong>Summary:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>Description:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Current Value:</strong> ${{ .CommonLabels.value }}</p>
    
  - name: 'data-quality-alerts'
    email_configs:
      - to: 'data-team@axiom.com'
        headers:
          Subject: 'üìä [Data Quality] {{ .GroupLabels.alertname }}'
        html: |
          <h2>Data Quality Alert</h2>
          <p><strong>Alert:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>Table:</strong> {{ .CommonLabels.table_name }}</p>
          <p><strong>Issue:</strong> {{ .CommonAnnotations.description }}</p>
    
  - name: 'pipeline-alerts'
    email_configs:
      - to: 'devops@axiom.com, team@axiom.com'
        headers:
          Subject: 'üîß [Pipeline] {{ .GroupLabels.alertname }}'
        html: |
          <h2>Pipeline Alert: {{ .GroupLabels.alertname }}</h2>
          <p><strong>DAG:</strong> {{ .CommonLabels.dag_id }}</p>
          <p><strong>Issue:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Severity:</strong> {{ .CommonLabels.severity }}</p>
    
  - name: 'sla-alerts'
    email_configs:
      - to: 'sre@axiom.com, management@axiom.com'
        headers:
          Subject: '‚è∞ [SLA VIOLATION] {{ .GroupLabels.alertname }}'
        html: |
          <h2 style="color: orange;">SLA Violation</h2>
          <p><strong>Alert:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>DAG:</strong> {{ .CommonLabels.dag_id }}</p>
          <p><strong>Task:</strong> {{ .CommonLabels.task_id }}</p>
          <p><strong>Description:</strong> {{ .CommonAnnotations.description }}</p>

# Inhibition rules - prevent alert spam
inhibit_rules:
  # If critical alert is firing, suppress warnings
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster', 'service']
  
  # If service is down, suppress performance alerts
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*Performance.*|.*Latency.*'
    equal: ['service']